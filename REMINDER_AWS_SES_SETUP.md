# Amazon SES Setup Guide for Reminder

## ðŸ”§ Amazon SES Setup for Reminder Payment Platform

### 1. AWS Account Setup
```bash
# Create AWS account if you don't have one
# Go to: https://aws.amazon.com/
```

### 2. SES Configuration in ME-South-1 (Bahrain) Region

**Important**: Use ME-South-1 for UAE compliance and optimal delivery.

1. **Access SES Console**
   - Go to AWS Console â†’ SES
   - Select **ME-South-1 (Bahrain)** region
   - This is closest to UAE for best performance

2. **Verify Email Addresses**
   ```
   SES Console â†’ Email Addresses â†’ Verify a New Email Address
   ```
   - Add your `from` email (e.g., `noreply@usereminder.com`)
   - Check email and click verification link
   - Add support email: `support@usereminder.com`

3. **Verify Domain (Recommended)**
   ```
   SES Console â†’ Domains â†’ Verify a New Domain
   ```
   - Enter your domain: `usereminder.com`
   - Generate DKIM records
   - Add DNS records to your domain:
     - TXT record for domain verification
     - CNAME records for DKIM (3 records)

### 3. Move Out of Sandbox Mode

**Critical**: SES starts in sandbox mode (can only send to verified emails).

1. **Request Production Access**
   ```
   SES Console â†’ Account Dashboard â†’ Request a Sending Limit Increase
   ```

2. **Fill out the form**:
   - **Mail Type**: Transactional
   - **Website URL**: https://usereminder.com
   - **Use Case Description**:
     ```
     UAE-based payment reminder platform sending automated payment
     reminders to business customers. Emails are transactional
     (invoice notifications, payment reminders, receipts) sent only
     to opted-in business customers. Reminder helps UAE SMEs automate
     their accounts receivable process. Expected volume: 5000-25000 emails/month.
     ```
   - **Bounce/Complaint Handling**: Webhook implementation for automatic suppression

### 4. Environment Variables for Reminder

Add to your `.env` file:

```bash
# AWS SES Configuration for Reminder
AWS_ACCESS_KEY_ID="your-access-key-id"
AWS_SECRET_ACCESS_KEY="your-secret-access-key"
AWS_REGION="me-south-1"
AWS_SES_FROM_EMAIL="noreply@usereminder.com"
FROM_NAME="Reminder - Payment Collection"
REPLY_TO_EMAIL="support@usereminder.com"

# Optional: SES Configuration Set
AWS_SES_CONFIGURATION_SET="reminder-transactional"

# Reminder Application URLs
NEXT_PUBLIC_BASE_URL="https://usereminder.com"
NEXT_PUBLIC_APP_URL="https://app.usereminder.com"
```

### 5. DNS Records for usereminder.com

Add these DNS records for better deliverability:

```bash
# SPF Record
TXT @ "v=spf1 include:amazonses.com ~all"

# DMARC Record
TXT _dmarc "v=DMARC1; p=quarantine; rua=mailto:dmarc@usereminder.com"

# DKIM Records (generated by SES)
CNAME [ses-generated-name]._domainkey [ses-target]
```

### 6. Configuration Set for Reminder

```bash
# Create configuration set for tracking
SES Console â†’ Configuration Sets â†’ Create Configuration Set
```

**Configuration Set Name**: `reminder-transactional`

**Add Event Destinations**:
- **SNS Topic**: `reminder-ses-notifications`
- **Webhook URL**: `https://usereminder.com/api/webhooks/ses-delivery`

### 7. IAM Policy for Reminder

Create dedicated SES user with minimal permissions:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ses:SendEmail",
                "ses:SendRawEmail",
                "ses:SendTemplatedEmail",
                "ses:GetSendQuota",
                "ses:GetSendStatistics"
            ],
            "Resource": "*",
            "Condition": {
                "StringEquals": {
                    "ses:FromAddress": [
                        "noreply@usereminder.com",
                        "support@usereminder.com"
                    ]
                }
            }
        }
    ]
}
```

### 8. Test Reminder Email System

Use the existing test endpoint:

```bash
# Test email sending (development only)
curl -X POST http://localhost:3000/api/invoices/test-invoice-id/send-email \
  -H "Content-Type: application/json" \
  -d '{
    "recipientEmail": "test@usereminder.com",
    "subject": "Test Reminder Payment Email",
    "language": "ENGLISH"
  }'
```

### 9. Webhook Setup for Delivery Tracking

1. **Create SNS Topic**
   ```
   SNS Console â†’ Topics â†’ Create Topic
   Name: reminder-ses-notifications
   ```

2. **Subscribe Reminder Webhook**
   ```
   Protocol: HTTPS
   Endpoint: https://usereminder.com/api/webhooks/ses-delivery
   ```

### 10. Monitoring for Reminder

**CloudWatch Metrics to Monitor**:
- Send rate
- Bounce rate (keep under 5%)
- Complaint rate (keep under 0.1%)
- Delivery rate

**Set up Alarms**:
- Bounce rate > 5% â†’ Alert dev team
- Complaint rate > 0.1% â†’ Alert dev team
- Send quota approaching limit â†’ Scale up

### 11. Reminder-Specific Considerations

1. **Business Hours**: Automatic UAE business hours scheduling
2. **Cultural Compliance**: Respectful tone in Arabic/English
3. **Domain Trust**: usereminder.com builds sender reputation
4. **Ramadan Awareness**: Sensitive timing during holy months
5. **Multi-tenant**: Company-isolated email tracking

### ðŸ“Š Expected Costs for Reminder

**SES Pricing (ME-South-1)**:
- First 62,000 emails/month: $0.10 per 1,000 emails
- Additional emails: $0.10 per 1,000 emails
- 25,000 emails/month â‰ˆ $2.50/month
- Very cost-effective for payment reminders

### ðŸš€ Integration with Reminder

Your Reminder email system is already configured to work with SES:

- **EmailService** class handles all SES integration
- **Template system** with Reminder branding
- **Webhook handler** for delivery tracking
- **Email history** with analytics
- **Suppression list** for bounces/complaints

Once SES is configured, Reminder will automatically:
- Send payment reminders with professional templates
- Track delivery status in real-time
- Handle bounces and complaints automatically
- Provide detailed email analytics per invoice
- Respect UAE business hours and cultural norms

Your Reminder platform is ready for production email delivery! ðŸŽ‰